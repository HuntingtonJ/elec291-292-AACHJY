                 -1   $MODLP51
0000              1   ;--------------------------------------------------------
0000              2   ; Special Function Registers
0000              3   ;--------------------------------------------------------
0000              4   ACC            DATA 0xe0
0000              5   B              DATA 0xf0
0000              6   PSW            DATA 0xd0
0000              7   SP             DATA 0x81
0000              8   SPX            DATA 0xef
0000              9   DPL            DATA 0x82
0000             10   DPH            DATA 0x83
0000             11   DPLB           DATA 0xd4
0000             12   DPHB           DATA 0xd5
0000             13   PAGE           DATA 0xf6
0000             14   AX             DATA 0xe1
0000             15   BX             DATA 0xf7
0000             16   DSPR           DATA 0xe2
0000             17   FIRD           DATA 0xe3
0000             18   MACL           DATA 0xe4
0000             19   MACH           DATA 0xe5
0000             20   PCON           DATA 0x87
0000             21   AUXR           DATA 0x8e
0000             22   AUXR1          DATA 0xa2
0000             23   DPCF           DATA 0xa1
0000             24   CKRL           DATA 0x97
0000             25   CKCKON0        DATA 0x8f
0000             26   CKCKON1        DATA 0xaf
0000             27   CKSEL          DATA 0x85
0000             28   CLKREG         DATA 0xae
0000             29   OSCCON         DATA 0x85
0000             30   IE             DATA 0xa8
0000             31   IEN0           DATA 0xa8
0000             32   IEN1           DATA 0xb1
0000             33   IPH0           DATA 0xb7
0000             34   IP             DATA 0xb8
0000             35   IPL0           DATA 0xb8
0000             36   IPH1           DATA 0xb3
0000             37   IPL1           DATA 0xb2
0000             38   P0             DATA 0x80
0000             39   P1             DATA 0x90
0000             40   P2             DATA 0xa0
0000             41   P3             DATA 0xb0
0000             42   P4             DATA 0xc0
0000             43   P0M0           DATA 0xe6
0000             44   P0M1           DATA 0xe7
0000             45   P1M0           DATA 0xd6
0000             46   P1M1           DATA 0xd7
0000             47   P2M0           DATA 0xce
0000             48   P2M1           DATA 0xcf
0000             49   P3M0           DATA 0xc6
0000             50   P3M1           DATA 0xc7
0000             51   P4M0           DATA 0xbe
0000             52   P4M1           DATA 0xbf
0000             53   SCON           DATA 0x98
0000             54   SBUF           DATA 0x99
0000             55   SADEN          DATA 0xb9
0000             56   SADDR          DATA 0xa9
0000             57   BDRCON         DATA 0x9b
0000             58   BRL            DATA 0x9a
0000             59   TCON           DATA 0x88
0000             60   TMOD           DATA 0x89
0000             61   TCONB          DATA 0x91
0000             62   TL0            DATA 0x8a
0000             63   TH0            DATA 0x8c
0000             64   TL1            DATA 0x8b
0000             65   TH1            DATA 0x8d
0000             66   RL0            DATA 0xf2
0000             67   RL1            DATA 0xf3
0000             68   RH0            DATA 0xf4
0000             69   RH1            DATA 0xf5
0000             70   WDTRST         DATA 0xa6
0000             71   WDTPRG         DATA 0xa7
0000             72   T2CON          DATA 0xc8
0000             73   T2MOD          DATA 0xc9
0000             74   RCAP2H         DATA 0xcb
0000             75   RCAP2L         DATA 0xca
0000             76   TH2            DATA 0xcd
0000             77   TL2            DATA 0xcc
0000             78   SPCON          DATA 0xc3
0000             79   SPSTA          DATA 0xc4
0000             80   SPDAT          DATA 0xc5
0000             81   SSCON          DATA 0x93
0000             82   SSCS           DATA 0x94
0000             83   SSDAT          DATA 0x95
0000             84   SSADR          DATA 0x96
0000             85   KBLS           DATA 0x9c
0000             86   KBE            DATA 0x9d
0000             87   KBF            DATA 0x9e
0000             88   KBMOD          DATA 0x9f
0000             89   BMSEL          DATA 0x92
0000             90   FCON           DATA 0xd2
0000             91   EECON          DATA 0xd2
0000             92   ACSRA          DATA 0xa3
0000             93   ACSRB          DATA 0xab
0000             94   AREF           DATA 0xbd
0000             95   DADC           DATA 0xa4
0000             96   DADI           DATA 0xa5
0000             97   DADL           DATA 0xac
0000             98   DADH           DATA 0xad
0000             99   CCON           DATA 0xd8
0000            100   CMOD           DATA 0xd9
0000            101   CL             DATA 0xe9
0000            102   CH             DATA 0xf9
0000            103   CCAPM0         DATA 0xda
0000            104   CCAPM1         DATA 0xdb
0000            105   CCAPM2         DATA 0xdc
0000            106   CCAPM3         DATA 0xdd
0000            107   CCAPM4         DATA 0xde
0000            108   CCAP0H         DATA 0xfa
0000            109   CCAP1H         DATA 0xfb
0000            110   CCAP2H         DATA 0xfc
0000            111   CCAP3H         DATA 0xfd
0000            112   CCAP4H         DATA 0xfe
0000            113   CCAP0L         DATA 0xea
0000            114   CCAP1L         DATA 0xeb
0000            115   CCAP2L         DATA 0xec
0000            116   CCAP3L         DATA 0xed
0000            117   CCAP4L         DATA 0xee
0000            118   ;--------------------------------------------------------
0000            119   ; special function bits
0000            120   ;--------------------------------------------------------
0000            121   P              BIT 0xd0
0000            122   F1             BIT 0xd1
0000            123   OV             BIT 0xd2
0000            124   RS0            BIT 0xd3
0000            125   RS1            BIT 0xd4
0000            126   F0             BIT 0xd5
0000            127   AC             BIT 0xd6
0000            128   CY             BIT 0xd7
0000            129   EX0            BIT 0xa8
0000            130   ET0            BIT 0xa9
0000            131   EX1            BIT 0xaa
0000            132   ET1            BIT 0xab
0000            133   ES             BIT 0xac
0000            134   ET2            BIT 0xad
0000            135   EC             BIT 0xae
0000            136   EA             BIT 0xaf
0000            137   PX0            BIT 0xb8
0000            138   PT0            BIT 0xb9
0000            139   PX1            BIT 0xba
0000            140   PT1            BIT 0xbb
0000            141   PS             BIT 0xbc
0000            142   PT2            BIT 0xbd
0000            143   IP0D           BIT 0xbf
0000            144   PPCL           BIT 0xbe
0000            145   PT2L           BIT 0xbd
0000            146   PLS            BIT 0xbc
0000            147   PT1L           BIT 0xbb
0000            148   PX1L           BIT 0xba
0000            149   PT0L           BIT 0xb9
0000            150   PX0L           BIT 0xb8
0000            151   RXD            BIT 0xb0
0000            152   TXD            BIT 0xb1
0000            153   INT0           BIT 0xb2
0000            154   INT1           BIT 0xb3
0000            155   T0             BIT 0xb4
0000            156   T1             BIT 0xb5
0000            157   WR             BIT 0xb6
0000            158   RD             BIT 0xb7
0000            159   RI             BIT 0x98
0000            160   TI             BIT 0x99
0000            161   RB8            BIT 0x9a
0000            162   TB8            BIT 0x9b
0000            163   REN            BIT 0x9c
0000            164   SM2            BIT 0x9d
0000            165   SM1            BIT 0x9e
0000            166   SM0            BIT 0x9f
0000            167   IT0            BIT 0x88
0000            168   IE0            BIT 0x89
0000            169   IT1            BIT 0x8a
0000            170   IE1            BIT 0x8b
0000            171   TR0            BIT 0x8c
0000            172   TF0            BIT 0x8d
0000            173   TR1            BIT 0x8e
0000            174   TF1            BIT 0x8f
0000            175   CP_RL2         BIT 0xc8
0000            176   C_T2           BIT 0xc9
0000            177   TR2            BIT 0xca
0000            178   EXEN2          BIT 0xcb
0000            179   TCLK           BIT 0xcc
0000            180   RCLK           BIT 0xcd
0000            181   EXF2           BIT 0xce
0000            182   TF2            BIT 0xcf
0000            183   CF             BIT 0xdf
0000            184   CR             BIT 0xde
0000            185   CCF4           BIT 0xdc
0000            186   CCF3           BIT 0xdb
0000            187   CCF2           BIT 0xda
0000            188   CCF1           BIT 0xd9
0000            189   CCF0           BIT 0xd8
0000              2   
0000              3   ; There is a couple of typos in MODLP51 in the definition of the timer 0/1 reload
0000              4   ; special function registers (SFRs), so:
0000              5   
0000              6   TIMER0_RELOAD_L DATA 0xf2
0000              7   TIMER1_RELOAD_L DATA 0xf3
0000              8   TIMER0_RELOAD_H DATA 0xf4
0000              9   TIMER1_RELOAD_H DATA 0xf5
0000             10   
0000             11   CLK           EQU 22118400 ; Microcontroller system crystal frequency in Hz
0000             12   TIMER0_RATE   EQU 4096     ; 2048Hz squarewave (peak amplitude of CEM-1203 speaker)
0000             13   TIMER0_RELOAD EQU ((65536-(CLK/TIMER0_RATE)))
0000             14   TIMER2_RATE   EQU 1000     ; 1000Hz, for a timer tick of 1ms
0000             15   TIMER2_RELOAD EQU ((65536-(CLK/TIMER2_RATE)))
0000             16   
0000             17   org 0x0000
0000 0204F4      18      ljmp MainProgram
0003             19   
0003             20   ; External interrupt 0 vector (not used in this code)
0003             21   org 0x0003
0003 32          22            reti
0004             23   
0004             24   ; Timer/Counter 0 overflow interrupt vector
000B             25   org 0x000B
000B 020365      26            ljmp Timer0_ISR
000E             27   
000E             28   ; External interrupt 1 vector (not used in this code)
0013             29   org 0x0013
0013 32          30            reti
0014             31   
0014             32   ; Timer/Counter 1 overflow interrupt vector (not used in this code)
001B             33   org 0x001B
001B 32          34            reti
001C             35   
001C             36   ; Serial port receive/transmit interrupt vector (not used in this code)
0023             37   org 0x0023 
0023 32          38            reti
0024             39            
0024             40   ; Timer/Counter 2 overflow interrupt vector
002B             41   org 0x002B
002B 020381      42            ljmp Timer2_ISR
002E             43   
002E             44   BAUD equ 115200
002E             45   BRG_VAL equ (0x100-(CLK/(16*BAUD)))
002E             46   
002E             47   ; These ’EQU’ must match the wiring between the microcontroller and ADC
002E             48   SOUND_OUT   EQU P3.7
002E             49   CE_ADC      EQU P2.4
002E             50   MY_MOSI     EQU P2.5
002E             51   MY_MISO     EQU P2.6
002E             52   MY_SCLK     EQU P2.7
002E             53   
0030             54   DSEG at 0x30
0030             55   Count1ms:      ds 2 ; Used to determine when half second has passed
0032             56   Result: ds 2
0034             57   x:      ds 4
0038             58   y:      ds 4
003C             59   bcd:    ds 5
0041             60   
0000             61   BSEG
0000             62   mf: dbit 1
0001             63   
                546   $LIST
                 65   $LIST
029E             67   
029E             68   CSEG
029E             69   LCD_RS equ P1.1
029E             70   LCD_RW equ P1.2
029E             71   LCD_E  equ P1.3
029E             72   LCD_D4 equ P3.2
029E             73   LCD_D5 equ P3.3
029E             74   LCD_D6 equ P3.4
029E             75   LCD_D7 equ P3.5
029E             76   
                 78   	$LIST
034C             80   
034C             81   ;---------------------------------;
034C             82   ; Routine to initialize the ISR   ;
034C             83   ; for timer 0                     ;
034C             84   ;---------------------------------;
034C             85   Timer0_Init:
034C E589        86            mov a, TMOD
034E 54F0        87            anl a, #0xf0 ; Clear the bits for timer 0
0350 4401        88            orl a, #0x01 ; Configure timer 0 as 16-timer
0352 F589        89            mov TMOD, a
0354 758CEA      90            mov TH0, #high(TIMER0_RELOAD)
0357 758AE8      91            mov TL0, #low(TIMER0_RELOAD)
035A             92            ; Set autoreload value
035A 75F4EA      93            mov TIMER0_RELOAD_H, #high(TIMER0_RELOAD)
035D 75F2E8      94            mov TIMER0_RELOAD_L, #low(TIMER0_RELOAD)
0360             95            ; Enable the timer and interrupts
0360 D2A9        96       setb ET0  ; Enable timer 0 interrupt
0362 D28C        97       setb TR0  ; Start timer 0
0364 22          98            ret
0365             99   
0365            100   ;---------------------------------;
0365            101   ; ISR for timer 0.  Set to execute;
0365            102   ; every 1/4096Hz to generate a    ;
0365            103   ; 2048 Hz square wave at pin P3.7 ;
0365            104   ;---------------------------------;
0365            105   Timer0_ISR:
0365            106            ;clr TF0  ; According to the data sheet this is done for us already.
0365 8000       107            sjmp no_beep
0367            108   beep_on:
0367            109            ;cpl SOUND_OUT ; Connect speaker to P3.7!
0367            110   no_beep:
0367 32         111            reti
0368            112   
                113   Send_BCD mac
                114   	push ar0
                115   	mov r0, %0
                116   	lcall ?Send_BCD
                117   	mov a, #'\r'
                118       lcall putchar
                119       mov a, #'\n'
                120       lcall putchar
                121   	pop ar0
                122   endmac
0368            123   ;---------------------------------;
0368            124   ; Routine to initialize the ISR   ;
0368            125   ; for timer 2                     ;
0368            126   ;---------------------------------;
0368            127   Timer2_Init:
0368 75C800     128            mov T2CON, #0 ; Stop timer/counter.  Autoreload mode.
036B 75CDA9     129            mov TH2, #high(TIMER2_RELOAD)
036E 75CC9A     130            mov TL2, #low(TIMER2_RELOAD)
0371            131            ; Set the reload value
0371 75CBA9     132            mov RCAP2H, #high(TIMER2_RELOAD)
0374 75CA9A     133            mov RCAP2L, #low(TIMER2_RELOAD)
0377            134            ; Init One millisecond interrupt counter.  It is a 16-bit variable made with two 8-bit parts
0377 E4         135            clr a
0378 F530       136            mov Count1ms+0, a
037A F531       137            mov Count1ms+1, a
037C            138            ; Enable the timer and interrupts
037C D2AD       139       setb ET2  ; Enable timer 2 interrupt
037E D2CA       140       setb TR2  ; Enable timer 2
0380 22         141            ret
0381            142   
0381            143   ;---------------------------------;
0381            144   ; ISR for timer 2                 ;
0381            145   ;---------------------------------;
0381            146   Timer2_ISR:
0381 C2CF       147            clr TF2  ; Timer 2 doesn't clear TF2 automatically. Do it in ISR
0383 B2B6       148            cpl P3.6 ; To check the interrupt rate with oscilloscope. It must be precisely a 1 ms pulse.
0385            149            
0385            150            ; The two registers used in the ISR must be saved in the stack
0385 C0E0       151            push acc
0387 C0D0       152            push psw
0389            153            
0389            154            ; Increment the 16-bit one mili second counter
0389 0530       155            inc Count1ms+0                ; Increment the low 8-bits first
038B E530       156            mov a, Count1ms+0             
038D 7002       157            jnz Timer2_ISR_done
038F 0531       158            inc Count1ms+1
0391            159            
0391            160   Timer2_ISR_done:
0391 D0D0       161            pop psw
0393 D0E0       162            pop acc
0395 32         163            reti
0396            164   
0396            165   ; Configure the serial port and baud rate
0396            166   InitSerialPort:
0396            167       ; Since the reset button bounces, we need to wait a bit before
0396            168       ; sending messages, otherwise we risk displaying gibberish!
0396 79DE       169       mov R1, #222
0398 78A6       170       mov R0, #166
039A D8FE       171       djnz R0, $   ; 3 cycles->3*45.21123ns*166=22.51519us
039C D9FA       172       djnz R1, $-4 ; 22.51519us*222=4.998ms
039E            173       ; Now we can proceed with the configuration
039E 438780     174            orl     PCON,#0x80
03A1 759852     175            mov     SCON,#0x52
03A4 759B00     176            mov     BDRCON,#0x00
03A7 759AF4     177            mov     BRL,#BRG_VAL
03AA 759B1E     178            mov     BDRCON,#0x1E ; BDRCON=BRR|TBCK|RBCK|SPD;
03AD 22         179       ret
03AE            180   
03AE            181   ; Send a character using the serial port
03AE            182   putchar:
03AE 3099FD     183       jnb TI, putchar
03B1 C299       184       clr TI
03B3 F599       185       mov SBUF, a
03B5 22         186       ret
03B6            187   
03B6            188   ; Send a constant-zero-terminated string using the serial port
03B6            189   SendString:
03B6 E4         190       clr A
03B7 93         191       movc A, @A+DPTR
03B8 6006       192       jz SendStringDone
03BA 1203AE     193       lcall putchar
03BD A3         194       inc DPTR
03BE 80F6       195       sjmp SendString
03C0            196   SendStringDone:
03C0 22         197       ret
03C1            198       
03C1            199   INIT_SPI:
03C1 D2A6       200            setb MY_MISO ; Make MISO an input pin
03C3 C2A7       201            clr MY_SCLK ; For mode (0,0) SCLK is zero
03C5 22         202            ret
03C6            203   
03C6            204   DO_SPI_G:
03C6 C0E0       205            push acc
03C8 7900       206            mov R1, #0 ; Received byte stored in R1
03CA 7A08       207            mov R2, #8 ; Loop counter (8-bits)
03CC            208   DO_SPI_G_LOOP:
03CC E8         209            mov a, R0 ; Byte to write is in R0
03CD 33         210            rlc a ; Carry flag has bit to write
03CE F8         211            mov R0, a
03CF 92A5       212            mov MY_MOSI, c
03D1 D2A7       213            setb MY_SCLK ; Transmit
03D3 A2A6       214            mov c, MY_MISO ; Read received bit
03D5 E9         215            mov a, R1 ; Save received bit in R1
03D6 33         216            rlc a
03D7 F9         217            mov R1, a
03D8 C2A7       218            clr MY_SCLK
03DA DAF0       219            djnz R2, DO_SPI_G_LOOP
03DC D0E0       220            pop acc
03DE 22         221            ret
03DF            222    
03DF            223   Hello_World:
03DF 48656C6C   224       DB  'Hello, World!', '\r', '\n', 0
     6F2C2057
     6F726C64
     210D0A00
03EF            225       
03EF            226   Delay:
03EF 79DE       227            mov R1, #222
03F1 78A6       228       mov R0, #166
03F3 D8FE       229       djnz R0, $   ; 3 cycles->3*45.21123ns*166=22.51519us
03F5 D9FA       230       djnz R1, $-4 ; 22.51519us*222=4.998ms
03F7 32         231       reti
03F8            232       
                233   Left_blank mac
                234   	mov a, %0
                235   	anl a, #0xf0
                236   	swap a
                237   	jz Left_blank_%M_a
                238   	ljmp %1
                239   Left_blank_%M_a:
                240   	Display_char(#' ')
                241   	mov a, %0
                242   	anl a, #0x0f
                243   	jz Left_blank_%M_b
                244   	ljmp %1
                245   Left_blank_%M_b:
                246   	Display_char(#' ')
                247   endmac
03F8            248      
03F8            249   ; Sends 10-digit BCD number in bcd to the LCD 
03F8            250   Display_10_digit_BCD:
03F8 C0E0       251            push acc
03FA 7407       251            mov a, #7
03FC 14         251            dec a
03FD 12032F     251            lcall ?Set_Cursor_2 ; Select column and row
0400 D0E0       251            pop acc
0402 C000       252            push ar0
0404 A840       252            mov r0, bcd+4
0406 120336     252            lcall ?Display_BCD
0409 D000       252            pop ar0
040B C000       253            push ar0
040D A83F       253            mov r0, bcd+3
040F 120336     253            lcall ?Display_BCD
0412 D000       253            pop ar0
0414 C000       254            push ar0
0416 A83E       254            mov r0, bcd+2
0418 120336     254            lcall ?Display_BCD
041B D000       254            pop ar0
041D C000       255            push ar0
041F A83D       255            mov r0, bcd+1
0421 120336     255            lcall ?Display_BCD
0424 D000       255            pop ar0
0426 C000       256            push ar0
0428 A83C       256            mov r0, bcd+0
042A 120336     256            lcall ?Display_BCD
042D D000       256            pop ar0
042F            257            ; Replace all the zeros to the left with blanks
042F C0E0       258            push acc
0431 7407       258            mov a, #7
0433 14         258            dec a
0434 12032F     258            lcall ?Set_Cursor_2 ; Select column and row
0437 D0E0       258            pop acc
0439 E540       259            mov a, bcd+4
043B 54F0       259            anl a, #0xf0
043D C4         259            swap a
043E 6003       259            jz Left_blank_15_a
0440 0204DD     259            ljmp skip_blank
0443            259   Left_blank_15_a:
0443 C0E0       259            push acc
0445 7420       259            mov a, #' '
0447 1202EE     259            lcall ?WriteData
044A D0E0       259            pop acc
044C E540       259            mov a, bcd+4
044E 540F       259            anl a, #0x0f
0450 6003       259            jz Left_blank_15_b
0452 0204DD     259            ljmp skip_blank
0455            259   Left_blank_15_b:
0455 C0E0       259            push acc
0457 7420       259            mov a, #' '
0459 1202EE     259            lcall ?WriteData
045C D0E0       259            pop acc
045E E53F       260            mov a, bcd+3
0460 54F0       260            anl a, #0xf0
0462 C4         260            swap a
0463 6003       260            jz Left_blank_18_a
0465 0204DD     260            ljmp skip_blank
0468            260   Left_blank_18_a:
0468 C0E0       260            push acc
046A 7420       260            mov a, #' '
046C 1202EE     260            lcall ?WriteData
046F D0E0       260            pop acc
0471 E53F       260            mov a, bcd+3
0473 540F       260            anl a, #0x0f
0475 6003       260            jz Left_blank_18_b
0477 0204DD     260            ljmp skip_blank
047A            260   Left_blank_18_b:
047A C0E0       260            push acc
047C 7420       260            mov a, #' '
047E 1202EE     260            lcall ?WriteData
0481 D0E0       260            pop acc
0483 E53E       261            mov a, bcd+2
0485 54F0       261            anl a, #0xf0
0487 C4         261            swap a
0488 6003       261            jz Left_blank_21_a
048A 0204DD     261            ljmp skip_blank
048D            261   Left_blank_21_a:
048D C0E0       261            push acc
048F 7420       261            mov a, #' '
0491 1202EE     261            lcall ?WriteData
0494 D0E0       261            pop acc
0496 E53E       261            mov a, bcd+2
0498 540F       261            anl a, #0x0f
049A 6003       261            jz Left_blank_21_b
049C 0204DD     261            ljmp skip_blank
049F            261   Left_blank_21_b:
049F C0E0       261            push acc
04A1 7420       261            mov a, #' '
04A3 1202EE     261            lcall ?WriteData
04A6 D0E0       261            pop acc
04A8 E53D       262            mov a, bcd+1
04AA 54F0       262            anl a, #0xf0
04AC C4         262            swap a
04AD 6003       262            jz Left_blank_24_a
04AF 0204DD     262            ljmp skip_blank
04B2            262   Left_blank_24_a:
04B2 C0E0       262            push acc
04B4 7420       262            mov a, #' '
04B6 1202EE     262            lcall ?WriteData
04B9 D0E0       262            pop acc
04BB E53D       262            mov a, bcd+1
04BD 540F       262            anl a, #0x0f
04BF 6003       262            jz Left_blank_24_b
04C1 0204DD     262            ljmp skip_blank
04C4            262   Left_blank_24_b:
04C4 C0E0       262            push acc
04C6 7420       262            mov a, #' '
04C8 1202EE     262            lcall ?WriteData
04CB D0E0       262            pop acc
04CD E53C       263            mov a, bcd+0
04CF 54F0       264            anl a, #0f0h
04D1 C4         265            swap a
04D2 7009       266            jnz skip_blank
04D4 C0E0       267            push acc
04D6 7420       267            mov a, #' '
04D8 1202EE     267            lcall ?WriteData
04DB D0E0       267            pop acc
04DD            268   skip_blank:
04DD 22         269            ret
04DE            270   
04DE            271   ?Send_BCD:
04DE C0E0       272            push acc
04E0            273            ; Write most significant digit
04E0 E8         274            mov a, r0
04E1 C4         275            swap a
04E2 540F       276            anl a, #0fh
04E4 4430       277            orl a, #30h
04E6 1203AE     278            lcall putchar
04E9            279            ; write least significant digit
04E9 E8         280            mov a, r0
04EA 540F       281            anl a, #0fh
04EC 4430       282            orl a, #30h
04EE 1203AE     283            lcall putchar
04F1 D0E0       284            pop acc
04F3 22         285            ret
04F4            286   
04F4            287   MainProgram:
04F4 75817F     288       mov SP, #7FH ; Set the stack pointer to the begining of idata
04F7            289       
04F7 12034C     290       lcall Timer0_Init
04FA 120368     291       lcall Timer2_Init
04FD            292       ; In case you decide to use the pins of P0, configure the port in bidirectional mode:
04FD 75E600     293       mov P0M0, #0
0500 75E700     294       mov P0M1, #0
0503 D2AF       295       setb EA   ; Enable Global interrupts
0505            296       
0505 120396     297       lcall InitSerialPort
0508 9003DF     298       mov DPTR, #Hello_World
050B 1203B6     299       lcall SendString
050E            300       
050E            301   forever:
050E 02050E     302       ljmp forever ; This is equivalent to 'forever: sjmp forever'
0511            303   EN
